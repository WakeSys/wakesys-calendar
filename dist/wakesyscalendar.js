/**
 * WakeSys Calendar v2.0.1
 * Copyright (c) 2025 wakesys s.Ã .r.l.
 * Licensed under GPL-3.0
 * 
 * @version 2.0.1
 */
"use strict";var WakeSysCalendarLib=(()=>{var M=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var B=Object.getOwnPropertyNames;var q=Object.prototype.hasOwnProperty;var j=(s,e)=>{for(var t in e)M(s,t,{get:e[t],enumerable:!0})},G=(s,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of B(e))!q.call(s,n)&&n!==t&&M(s,n,{get:()=>e[n],enumerable:!(o=W(e,n))||o.enumerable});return s};var z=s=>G(M({},"__esModule",{value:!0}),s);var K={};j(K,{WakeSysApiClient:()=>v,WakeSysCalendar:()=>k,addDays:()=>I,closeModal:()=>O,createElement:()=>d,darkenColor:()=>b,formatDate:()=>D,formatTime:()=>T,generateColor:()=>E,initWakeSysCalendarLegacy:()=>N,isSameDay:()=>P,jsonp:()=>h,parseDateTime:()=>f,subtractHours:()=>_,toggleLoadingOverlay:()=>C});var U=0;function h(s,e={}){return new Promise((t,o)=>{let n=`wakesys_jsonp_${Date.now()}_${U++}`,a=document.createElement("script"),c,l=()=>{clearTimeout(c),delete window[n],a.parentNode&&a.parentNode.removeChild(a)};window[n]=r=>{t(r),l()};let p=new URLSearchParams({...e,callback:n});a.src=`${s}?${p.toString()}`,a.onerror=()=>{o(new Error(`JSONP request failed: ${s}`)),l()},c=setTimeout(()=>{o(new Error(`JSONP request timed out: ${s}`)),l()},3e4),document.head.appendChild(a)})}var v=class{constructor(e){this.transportationsCache=null;this.endpoint=`https://${e}.wakesys.com`}getEndpoint(){return this.endpoint}async fetchEvents(e){let t=`${this.endpoint}/api/events.php`;return h(t,{start:e})}async fetchSlots(e,t){let o=`${this.endpoint}/api/heatmap.php`;return h(o,{start:e,transportation_name:t})}async fetchOpeningTimes(e,t){let o=`${this.endpoint}/api/opening_times.php`;return h(o,{start:e,transportation_name:t})}async fetchTransportations(){if(this.transportationsCache!==null)return this.transportationsCache;let e=`${this.endpoint}/api/list_transportations.php`,t=await h(e);return Array.isArray(t)?(this.transportationsCache=t,t):(console.error("Unexpected data format from transportations API:",t),[])}async fetchEventTypes(){let e=`${this.endpoint}/api/list_events.php`,t=await h(e);return Array.isArray(t)?t:(console.error("Unexpected data format from event types API:",t),[])}clearCache(){this.transportationsCache=null}};async function x(s,e){return{data:await s,type:e}}function D(s){let e=s.getFullYear(),t=String(s.getMonth()+1).padStart(2,"0"),o=String(s.getDate()).padStart(2,"0");return`${e}-${t}-${o}`}function T(s,e=!1){let t=s.getHours(),o=String(s.getMinutes()).padStart(2,"0");if(e){let n=t>=12?"PM":"AM";return`${t%12||12}:${o} ${n}`}return`${String(t).padStart(2,"0")}:${o}`}function f(s){return new Date(s.replace(" ","T"))}function _(s,e){return new Date(s.getTime()-e*60*60*1e3)}function I(s,e){let t=new Date(s);return t.setDate(t.getDate()+e),t}function P(s,e){return s.getFullYear()===e.getFullYear()&&s.getMonth()===e.getMonth()&&s.getDate()===e.getDate()}function g(s,e){return s.getTime()<=e.getTime()}function b(s,e){s=s.replace(/^#/,"");let t=parseInt(s.substring(0,2),16),o=parseInt(s.substring(2,4),16),n=parseInt(s.substring(4,6),16);return t=Math.max(0,Math.floor(t*(1-e/100))),o=Math.max(0,Math.floor(o*(1-e/100))),n=Math.max(0,Math.floor(n*(1-e/100))),"#"+[t,o,n].map(a=>a.toString(16).padStart(2,"0")).join("")}function E(s){let e=0;for(let n=0;n<s.length;n++)e=s.charCodeAt(n)+((e<<5)-e);let t=(e%360+360)%360;return"#"+V(t/360,.7,.9).map(n=>Math.round(n).toString(16).padStart(2,"0")).join("")}function V(s,e,t){let o,n,a,c=Math.floor(s*6),l=s*6-c,p=t*(1-e),r=t*(1-l*e),i=t*(1-(1-l)*e);switch(c%6){case 0:o=t,n=i,a=p;break;case 1:o=r,n=t,a=p;break;case 2:o=p,n=t,a=i;break;case 3:o=p,n=r,a=t;break;case 4:o=i,n=p,a=t;break;case 5:default:o=t,n=p,a=r;break}return[o*255,n*255,a*255]}function d(s,e,t){let o=document.createElement(s);return e&&(o.className=e),t!==void 0&&(o.innerHTML=t),o}function C(s,e,t){let o=document.getElementById("loadingOverlay");if(!o){o=d("div"),o.id="loadingOverlay",Object.assign(o.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.5)",display:"none",justifyContent:"center",alignItems:"center",zIndex:"1000"});let n=d("div");n.innerText=`${t.loading}...`,Object.assign(n.style,{fontSize:"1em",color:"white",padding:"20px",borderRadius:"5px",backgroundColor:"rgba(0, 0, 0, 0.8)"}),o.appendChild(n),s.style.position="relative",s.appendChild(o)}o.style.display=e?"flex":"none"}function L(s){if(!document.getElementById("wakesys-modal-styles")){let l=d("style");l.id="wakesys-modal-styles",l.innerHTML=`
      .wakesys-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 9999;
      }
      .wakesys-modal {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 80%;
        height: 80%;
        padding: 20px;
        background-color: white;
        border: 1px solid #ccc;
        overflow: auto;
        z-index: 10000;
      }
      .wakesys-instructions {
        color: red;
        font-weight: bold;
        padding-bottom: 20px;
      }
      .wakesys-close {
        position: absolute;
        top: 10px;
        right: 10px;
        cursor: pointer;
        font-size: 24px;
      }
      .wakesys-textarea {
        width: 100%;
        height: calc(100% - 80px);
        font-family: monospace;
      }
    `,document.head.appendChild(l)}let e=document.getElementById("wakesys-overlay");e&&e.remove();let t=d("div");t.id="wakesys-overlay",t.className="wakesys-overlay";let o=d("div");o.className="wakesys-modal";let n=d("div","wakesys-instructions");n.textContent="Please copy paste these settings into your configuration. Change the color for each event as necessary, and set events to false that you do not want to show in the calendar.";let a=d("span","wakesys-close");a.innerHTML="&times;",a.onclick=()=>{t.style.display="none"};let c=d("textarea","wakesys-textarea");c.readOnly=!0,c.value=s,o.appendChild(n),o.appendChild(a),o.appendChild(c),t.appendChild(o),document.body.appendChild(t),t.style.display="block"}function O(){let s=document.getElementById("wakesys-overlay");s&&(s.style.display="none")}typeof window<"u"&&(window.closeModal=O);var H={public_opening_hours:"Public Hours",slot:"Slot",bookable:"Available",booked_out:"Booked Out",not_available:"Not Available",currency:"\u20AC",full_booked:"Fully Booked",slotPrice:"from \u20AC20",loading:"Loading"},J={firstDayOfWeek:1,locale:"en-gb",minOpeningHours:"08:00:00",maxOpeningHours:"20:00:00",timeAmPm:!1,textColor:"#000",calendarHeight:"800px",hideEventsIfNotBookable:!1,headerToolbarLeft:"dayGridMonth,timeGridWeek,timeGridDay",translations:H,colors:{},eventsToShow:{},debug:!1},k=class{constructor(e,t){this.calendar=null;if(typeof e=="string"){let o=document.querySelector(e);if(!o)throw new Error(`Cannot find element: ${e}`);this.calendarEl=o}else this.calendarEl=e;this.config=this.resolveConfig(t),this.apiClient=new v(this.config.parkSubdomain),this.log("WakeSysCalendar initialized with config:",this.config)}resolveConfig(e){let t={...H,...e.translations};return{...J,...e,translations:t,endpoint:`https://${e.parkSubdomain}.wakesys.com`}}log(...e){this.config.debug&&console.log("[WakeSysCalendar]",...e)}render(){let e=!this.config.colors||Object.keys(this.config.colors).length===0,t=!this.config.eventsToShow||Object.keys(this.config.eventsToShow).length===0;if((e||t)&&this.generateConfiguration(),C(this.calendarEl,!0,this.config.translations),!window.FullCalendar){console.error("FullCalendar is not loaded. Please include FullCalendar before WakeSysCalendar.");return}this.calendar=new window.FullCalendar.Calendar(this.calendarEl,{timeZone:"local",height:this.config.calendarHeight,slotEventOverlap:0,initialView:window.innerWidth<765?"timeGridDay":"timeGridWeek",firstDay:this.config.firstDayOfWeek,locale:this.config.locale,headerToolbar:{left:"title",center:this.config.headerToolbarLeft,right:"today prev,next"},slotMinTime:this.config.minOpeningHours,slotMaxTime:this.config.maxOpeningHours,slotLabelInterval:{hours:1},slotLabelFormat:{hour:"2-digit",hour12:!1},slotLabelContent:o=>String(o.date.getHours()).padStart(2,"0"),events:this.fetchCalendarEvents.bind(this),loading:o=>{C(this.calendarEl,o,this.config.translations)},datesSet:()=>{this.calendar?.refetchEvents()},eventContent:this.renderEventContent.bind(this),eventClick:this.handleEventClick.bind(this),displayEventTime:!1,displayEventEnd:!1,defaultAllDay:!1}),this.calendar.render()}destroy(){this.calendar?.destroy(),this.calendar=null}async fetchCalendarEvents(e,t,o){try{let n=D(e.start),a=[],c=x(this.apiClient.fetchEvents(n),"eventsAPI"),l=await this.apiClient.fetchTransportations();this.log("Transportations loaded:",l);let p=[c];for(let i of l)i.col_option_heatmap==="yes"&&i.col_session_view!=="5mast"?p.push(x(this.apiClient.fetchSlots(n,i.Fcol_boat_cable_name),"slotsAPI")):i.col_session_view!=="events_only"&&p.push(x(this.apiClient.fetchOpeningTimes(n,i.Fcol_boat_cable_name),"OpeningTimesAPI"));let r=await Promise.all(p);for(let i of r)switch(this.log(`Processing ${i.type} response:`,i.data),i.type){case"eventsAPI":this.processEventsApiResponse(i.data,a);break;case"slotsAPI":this.processSlotsApiResponse(i.data,a);break;case"OpeningTimesAPI":this.processOpeningTimesApiResponse(i.data,a);break}t(a)}catch(n){console.error("Error fetching calendar events:",n),o(n)}}processEventsApiResponse(e,t){if(this.log("Processing events API response:",e),e===0){this.log("No events found");return}if(!Array.isArray(e)){console.error("Expected array for events response, got:",e);return}let o=new Date;for(let n of e){if(this.config.eventsToShow[n.FID_event_type]===!1)continue;let a=f(n.col_start),c=f(n.col_end),l=!P(a,c),p=l?I(c,1):c,r="#EEEEEE",i=parseInt(n.col_hours_in_advance,10)||0,m=_(a,i);if(g(m,o))r="#EEEEEE";else if(n.col_is_bookable==="yes")r=this.config.colors[n.FID_event_type]||r;else if(this.config.hideEventsIfNotBookable)continue;let u={title:n.col_name,classNames:`FID_event_type_${n.FID_event_type}`,start:a,end:p,backgroundColor:r,borderColor:b(r,25),textColor:this.config.textColor,allDay:l,extendedProps:{cableName:n.Fcol_boat_cable_name,description:n.col_description,seats:parseInt(n.col_seats,10)||null,price:`${n.col_price} ${this.config.translations.currency}`,hoursInAdvance:i,isBookable:n.col_is_bookable==="yes",checkinTime:n.col_checkin_time,bookedSeats:parseInt(n.col_booked_seats,10)||null,col_hours_in_advance:i}};n.col_is_bookable==="yes"&&!g(m,o)&&(u.url=n.col_link),this.log("Adding event:",u),t.push(u)}}processSlotsApiResponse(e,t){if(this.log("Processing slots API response:",e),e===0){this.log("No slots found");return}if(!Array.isArray(e)){console.error("Expected array for slots response, got:",e);return}if(this.config.eventsToShow.Slot===!1)return;let o=new Date;for(let n of e){let a=f(n.slot_time_start),c=f(n.slot_time_end),l="#EEEEEE",p=this.config.colors.Slot;g(a,o)?l="#EEEEEE":p?l=p:l=E("Slot");let r={title:this.config.translations.slot,classNames:"slot",start:a,end:c,backgroundColor:l,borderColor:b(l,25),textColor:this.config.textColor,allDay:!1,extendedProps:{cableName:n.Fcol_boat_cable_name,description:"",seats:parseInt(n.col_number_of_bookings,10)||null,price:this.config.translations.slotPrice,hoursInAdvance:0,isBookable:!0,checkinTime:"30",bookedSeats:parseInt(n.total,10)||null,col_hours_in_advance:0}};g(a,o)||(r.url=`${this.config.endpoint}/`),this.log("Adding slot:",r),t.push(r)}}processOpeningTimesApiResponse(e,t){if(this.log("Processing opening times API response:",e),this.config.eventsToShow.Slot===!1)return;let o=new Date;for(let[n,a]of Object.entries(e)){if(a.opening_times==="closed")continue;let[c,l]=a.opening_times.split(" - "),p=f(`${n}T${c}`),r=f(`${n}T${l}`),i="#EEEEEE",m=this.config.colors.Slot;g(r,o)?i="#EEEEEE":m?i=m:i=E("Slot");let u={title:this.config.translations.public_opening_hours,classNames:"opening_hours",start:p,end:r,backgroundColor:i,borderColor:b(i,25),textColor:this.config.textColor,allDay:!1,extendedProps:{cableName:a.transportation_name,description:"",seats:null,price:this.config.translations.slotPrice,hoursInAdvance:0,isBookable:!0,checkinTime:"30",bookedSeats:null,col_hours_in_advance:0}};g(r,o)||(u.url=`${this.config.endpoint}/`),this.log("Adding opening time:",u),t.push(u)}}renderEventContent(e){let{event:t}=e,o=t.extendedProps,n=new Date,a=o.col_hours_in_advance||0,c=t.start?T(t.start):"",l=t.end?T(t.end):"",p=t.start?_(t.start,a):new Date(0),r=o.bookedSeats,i=o.seats,m=d("div","fc-event-time");!t.allDay&&c&&l&&(m.innerHTML=`${c} - ${l}`);let u=d("div","fc-event-title",t.title),F=d("div","fc-event-cable",o.cableName),w=d("div","fc-event-capacity-price"),y="";if(i!==null&&i>0){let $=r??0;$>=i?y=this.config.translations.full_booked:y=`(${$}/${i})`}let A=o.price||"";y&&A?w.innerHTML=`${y} ${A}`:y?w.innerHTML=y:A&&(w.innerHTML=A);let Y=d("div","fc-event-capacity"),Z=d("div","fc-event-price"),S=d("div","fc-event-bookable");return r!==null&&i!==null&&r<i&&o.isBookable&&g(n,p)?S.innerHTML=`<span class="bookable">${this.config.translations.bookable}</span>`:r!==null&&i!==null&&r>=i&&o.isBookable&&g(n,p)?S.innerHTML=`<span class="booked_out">${this.config.translations.booked_out}</span>`:r!==null&&i!==null&&r<i&&!o.isBookable&&(S.innerHTML=`<span class="booked_out">${this.config.translations.not_available}</span>`),{domNodes:[m,u,F,w,S]}}handleEventClick(e){e.jsEvent.preventDefault(),e.event.url&&window.open(e.event.url,"_blank")}async generateConfiguration(){try{let e=await this.apiClient.fetchEventTypes(),t={Slot:"#88e645"},o={Slot:!0};for(let a of e)if(a&&a.col_name){let c=E(a.col_name);t[a.ID_event]=c,o[a.ID_event]=!0}let n=`colors: {
`;n+=`  'Slot': '${t.Slot}',  // Regular Opening Hours
`;for(let a of e)a&&a.col_name&&(n+=`  '${a.ID_event}': '${t[a.ID_event]}',  // ${a.col_name}
`);n+=`},

eventsToShow: {
`,n+=`  'Slot': true,  // Regular Opening Hours
`;for(let a of e)a&&a.col_name&&(n+=`  '${a.ID_event}': true,  // ${a.col_name}
`);n+="}",L(n)}catch(e){console.error("Error generating configuration:",e)}}getCalendarInstance(){return this.calendar}getApiClient(){return this.apiClient}refetchEvents(){this.calendar?.refetchEvents()}};function N(s="wakesys_calendar"){if(!document.getElementById(s))return console.error(`Cannot find <div id='${s}'></div>`),null;let t=window;if(!t.park_subdomain)return console.error("WakeSysCalendar: park_subdomain is required. Please set it before initializing."),null;let o={parkSubdomain:t.park_subdomain,firstDayOfWeek:t.park_first_day_of_week??1,locale:t.locale??"en-gb",minOpeningHours:t.park_min_opening_hours??"08:00:00",maxOpeningHours:t.park_max_opening_hours??"20:00:00",timeAmPm:t.park_time_am_or_pm??!1,textColor:t.textColor??"#000",calendarHeight:t.calendarHeight??"800px",hideEventsIfNotBookable:t.hideEventsIfNotBookable??!1,headerToolbarLeft:t.headerToolbarLeft??"dayGridMonth,timeGridWeek,timeGridDay",translations:t.translations,colors:t.colors,eventsToShow:t.eventsToShow},n=new k(`#${s}`,o);return n.render(),n}function R(){let s=window;document.getElementById("wakesys_calendar")&&s.park_subdomain&&window.FullCalendar&&N()}typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",R):R());return z(K);})();

// Expose WakeSysCalendar globally for script tag usage
if (typeof window !== 'undefined') {
  window.WakeSysCalendar = WakeSysCalendarLib.WakeSysCalendar;
  window.initWakeSysCalendarLegacy = WakeSysCalendarLib.initWakeSysCalendarLegacy;
}
//# sourceMappingURL=wakesyscalendar.js.map
